
<!-- saved from url=(0068)http://arcgis.github.io/StreamLayer-js/examples/flights/flights.html -->
<html><body><div class="webkit-line-gutter-backdrop"></div><table><tbody><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-doctype">&lt;!doctype html&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;html&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  <span class="webkit-html-tag">&lt;head&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;meta <span class="webkit-html-attribute-name">charset</span>="<span class="webkit-html-attribute-value">utf-8</span>"&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;meta <span class="webkit-html-attribute-name">http-equiv</span>="<span class="webkit-html-attribute-value">X-UA-Compatible</span>" <span class="webkit-html-attribute-name">content</span>="<span class="webkit-html-attribute-value">IE=7,IE=9</span>" /&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;meta <span class="webkit-html-attribute-name">name</span>="<span class="webkit-html-attribute-value">viewport</span>" <span class="webkit-html-attribute-name">content</span>="<span class="webkit-html-attribute-value">initial-scale=1, maximum-scale=1,user-scalable=no</span>"/&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;title&gt;</span>StreamLayer Using GEP<span class="webkit-html-tag">&lt;/title&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;link <span class="webkit-html-attribute-name">rel</span>="<span class="webkit-html-attribute-value">stylesheet</span>" <span class="webkit-html-attribute-name">href</span>="<a class="webkit-html-attribute-value webkit-html-resource-link" target="_blank" href="http://serverapi.arcgisonline.com/jsapi/arcgis/3.5/js/esri/css/esri.css">http://serverapi.arcgisonline.com/jsapi/arcgis/3.5/js/esri/css/esri.css</a>"&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;link <span class="webkit-html-attribute-name">rel</span>="<span class="webkit-html-attribute-value">stylesheet</span>" <span class="webkit-html-attribute-name">href</span>="<a class="webkit-html-attribute-value webkit-html-resource-link" target="_blank" href="http://serverapi.arcgisonline.com/jsapi/arcgis/3.5/js/dojo/dijit/themes/tundra/tundra.css">http://serverapi.arcgisonline.com/jsapi/arcgis/3.5/js/dojo/dijit/themes/tundra/tundra.css</a>"&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;style <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">text/css</span>"&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      html, body {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        height: 100%; width: 100%;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        margin: 0; padding: 0;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      body{</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        background-color: #fff; overflow:hidden;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        font-family: sans-serif;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      #map {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        width: 100%;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        height: 100%;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        background:rgb(80,80,80);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      #controls {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        position:absolute;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        top:18px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        left:100px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        width:300px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      #controls input {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        padding:10px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        color:#FEFEFE;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        background:#444;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        border:none;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      #controls input:hover {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        background: #333;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        color: #fff;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        cursor:pointer;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      #socket {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        display:none;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      .esriSimpleSlider div  {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        width: 36px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        height: 31px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        font-size: 24px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        font-family: verdana,helvetica;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        font-weight: bold;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        line-height: 25px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        -webkit-user-select: none;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        -moz-user-select: none;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        -ms-user-select: none;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        user-select: none;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        float: right;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        border: 1px solid #555;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      .esriSimpleSlider {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        position: absolute;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        text-align: center;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        background-color: #444;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        color: #FEFEFE;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        cursor: pointer;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        -webkit-user-select: none;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        -moz-user-select: none;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        -ms-user-select: none;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        user-select: none;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        border: none;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        border-radius:none;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      .esriSimpleSliderVertical .esriSimpleSliderIncrementButton {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        border-bottom: 1px solid #555;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;/style&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;script&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     var dojoConfig = {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        locale: "en",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        parseOnLoad: true,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      };</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;/script&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;script <span class="webkit-html-attribute-name">src</span>="<a class="webkit-html-attribute-value webkit-html-resource-link" target="_blank" href="http://serverapi.arcgisonline.com/jsapi/arcgis/3.5/">http://serverapi.arcgisonline.com/jsapi/arcgis/3.5/</a>"&gt;</span><span class="webkit-html-tag">&lt;/script&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  <span class="webkit-html-tag">&lt;/head&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  <span class="webkit-html-tag">&lt;body <span class="webkit-html-attribute-name">class</span>="<span class="webkit-html-attribute-value">tundra</span>"&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      <span class="webkit-html-tag">&lt;div <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">map</span>"&gt;</span><span class="webkit-html-tag">&lt;/div&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      <span class="webkit-html-tag">&lt;div <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">controls</span>"&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        <span class="webkit-html-tag">&lt;div <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">socket</span>"&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          <span class="webkit-html-tag">&lt;span&gt;</span>Enter websocket connection: <span class="webkit-html-tag">&lt;/span&gt;</span><span class="webkit-html-tag">&lt;input <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">text</span>" <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">txtWsUrl</span>" <span class="webkit-html-attribute-name">value</span>="<span class="webkit-html-attribute-value">ws://ec2-107-21-212-168.compute-1.amazonaws.com:8080/asdiflight</span>" <span class="webkit-html-attribute-name">style</span>="<span class="webkit-html-attribute-value">width: 400px</span>"/&gt;</span><span class="webkit-html-tag">&lt;br/&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        <span class="webkit-html-tag">&lt;/div&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        <span class="webkit-html-tag">&lt;input <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">button</span>" <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">cmdNewStream</span>" <span class="webkit-html-attribute-name">value</span>="<span class="webkit-html-attribute-value">Stream Flight Paths</span>" /&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        <span class="webkit-html-tag">&lt;input <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">button</span>" <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">cmdDisconnect</span>" <span class="webkit-html-attribute-name">value</span>="<span class="webkit-html-attribute-value">Disconnect Stream Layer</span>" /&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      <span class="webkit-html-tag">&lt;/div&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  <span class="webkit-html-tag">&lt;/body&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  <span class="webkit-html-tag">&lt;script&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">     /*</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      * requirements. Use callback to init the map and set click events for buttons</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      require(["esri/map",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        "esri/layers/FeatureLayer",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        "esri/layers/StreamLayer",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        "esri/layers/GraphicsLayer",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        "esri/geometry/Extent",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        "esri/symbols/SimpleMarkerSymbol",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        "esri/symbols/SimpleLineSymbol",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        "esri/renderers/SimpleRenderer",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        "esri/symbols/SimpleFillSymbol",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        "esri/graphic",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        "esri/geometry/Polyline",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        "esri/geometry/Point",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        "esri/geometry/jsonUtils",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        "dojo/_base/Color",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        "dojo/_base/connect",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        "dojo/domReady!"</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      ], function(Map, FeatureLayer, StreamLayer, GraphicsLayer, Extent, SimpleMarkerSymbol, SimpleLineSymbol, SimpleRenderer, SimpleFillSymbol, Graphic, Polyline, Point, jsonUtils, Color, connect){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          //console.log("In dom ready function");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          var connection,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            map,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            flightStreamLayer,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            flightLayer,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            trailLayer,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            tracklineLayer,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            layerDefinition,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            TRACK_ID_FIELD = "FltId",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            MAX_TRAIL = 6,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            SHOW_TRACKS = true,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            graphicsColl = {};</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          /*</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">           * LayerDefinition that defines schema of a flight message.</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">           *</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">           */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          layerDefinition = {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            "geometryType": "esriGeometryPoint",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            "fields": [</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                name: "ObjectId",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                type: "esriFieldTypeOID",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                alias: "ObjectId"</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                name: "AltitudeFeet",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                type: "esriFieldTypeDouble",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                alias: "AltitudeFeet"</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                name: "deparpt",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                type: "esriFieldTypeString",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                alias: "deparpt"</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                name: "msgtime",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                type: "esriFieldTypeDate",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                alias: "msgtime"</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                name: "FltId",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                type: "esriFieldTypeString",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                alias: "FltId"</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                name: "Heading",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                type: "esriFieldTypeDouble",</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                alias: "Heading"</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            ]</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          };</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          var bounds = new Extent({</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            "xmin":-16966135.58841464,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            "ymin":2551913.339721252,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            "xmax":-4376555.304442507,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            "ymax":8529100.339721255,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            "spatialReference":{"wkid":102100}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          });</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          var map = new Map("map", { </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            extent: bounds</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          });</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          dojo.connect(map, "onExtentChange", function(extent) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            // /console.log('extent', extent)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          });</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          var world = "http://sampleserver6.arcgisonline.com/arcgis/rest/services/WorldTimeZones/MapServer/2";</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          var fl = new FeatureLayer(world, {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            id: "world-regions"</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          });</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          var outline = new SimpleLineSymbol("solid", new Color([100, 100, 100, .5]), 1);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          var fill = new SimpleFillSymbol("solid", outline, new Color([33, 33, 33 ]));</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          fl.setRenderer(new SimpleRenderer(fill));</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          map.addLayer(fl);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          tracklineLayer = new GraphicsLayer();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          trailLayer = new GraphicsLayer();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          flightLayer = new GraphicsLayer();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          map.addLayer(tracklineLayer);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          map.addLayer(trailLayer);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          map.addLayer(flightLayer);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          //test stream layer</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          //flightStreamLayer = makeStreamLayer();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          //console.log("STREAM LAYER: ", flightStreamLayer);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          //map.addLayer(flightStreamLayer);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          //connect click events to buttons</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          //connect.connect(dojo.byId("cmdNewStream"), "onclick", connectStreamLayer);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          connect.connect(dojo.byId("cmdNewStream"), "onclick", connectSocket);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          connect.connect(dojo.byId("cmdDisconnect"), "onclick", disconnectStreamLayer);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          /*</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">           * Functions to make Streamlayer and process messages</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">           */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          function makeStreamLayer(){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            console.log("Making stream layer");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            var featureCollection,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            layer,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            renderer;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            //Make FeatureCollection to define layer without using url</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            featureCollection = {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            "layerDefinition": null,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            "featureSet": {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              "features": [],</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              "geometryType": "esriGeometryPoint"}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            };</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            featureCollection.layerDefinition = layerDefinition;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            /*</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">             * Instantiate StreamLayer</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">             *</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">             * 1. socketUrl is the url to the GeoEvent Processor web socket.</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">             * 2. purgeOptions.displayCount is the maximum number of features the</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">             *    layer will display at one time</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">             * 3. trackIdField is the name of the field that groups features</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">             */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            var layer = new esri.layers.StreamLayer(featureCollection, {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              socketUrl: txtWsUrl.value,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              purgeOptions: { displayCount: 5000 },</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              trackIdField: TRACK_ID_FIELD</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            });</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            //Make renderer and apply it to StreamLayer</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            var renderer = makeRenderer();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            //console.log("RENDERER: ", renderer);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            layer.setRenderer( renderer );</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            console.log("LAYER: ", layer);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            layer.socket.onmessage = function(e){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              processMessage(e.data);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            };</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            //Subscribe to onMessage event of StreamLayer so can adjust map time</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            connect.connect(layer, 'onMessage', function(msg){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              console.log("MESSAGE: ", msg);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            });</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            return layer;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          /*</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">           * Process message that websocket received. It is stringified Array of Feature JSON</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">           */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          function processMessage(message){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            var msgarray,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              feat,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              geom,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              addgraphics = [],</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              graphic,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              g,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              updates;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            msgarray = JSON.parse(message);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            if (! Array.isArray(msgarray)){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              msgarray = [msgarray];</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            handleFlightUpdates(msgarray);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          /*</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">           * Handle messages</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">           *  1. Add flight info to cache if not currently tracked</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">           *  2. Add point to breadcrumb trail and remove old breadcrumbs to keep at or below max</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">           *  3. Make track line to show path</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">           */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          function handleFlightUpdates(newFlights){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            var f,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              fltgraphicsinfo,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              fltgraphicsarray,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              graphic,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              currentgraphic,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              firstpos,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              flightid,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              g,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              agesymbol = makeMarker(false),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              t,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              maxInTrail,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              track;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            for (f = 0; f &lt; newFlights.length; f++){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              //get id of flight and graphics info associated with flight</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              flightid = newFlights[f].attributes[TRACK_ID_FIELD];</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              fltgraphicsinfo = graphicsColl[flightid];</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              //if flight is not already being tracked, make oject to store flight info</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              if (! fltgraphicsinfo){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                currentgraphic = makeCurrentPositionGraphic(newFlights[f]);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                //flightStreamLayer.add(currentgraphic);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                flightLayer.add(currentgraphic);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                graphicsColl[flightid] = {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                  currentPosition: currentgraphic,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                  trail: [],</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                  track: null,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                  updated: new Date()</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                };</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              else{</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                //add last mapped flight position to breadcrumb trail</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                graphic = makeTrailpointGraphic(fltgraphicsinfo.currentPosition.geometry);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                trailLayer.add(graphic);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                fltgraphicsinfo.trail.push(graphic);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                //trim trail if greater than max allowed</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                if (fltgraphicsinfo.trail.length &gt; MAX_TRAIL){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                  //graphic = fltgraphicsinfo.trail.shift();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                  //trailLayer.remove(fltgraphicsinfo.trail.shift());</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                //update current position</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                updateCurrentPosition(newFlights[f], fltgraphicsinfo.currentPosition);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                 //make line to show track</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                track = makeTrackLine(fltgraphicsinfo.track, fltgraphicsinfo.trail, fltgraphicsinfo.currentPosition);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                if (track &amp;&amp; ! fltgraphicsinfo.track){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                  fltgraphicsinfo.track = track;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                  tracklineLayer.add(track);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          function makeCurrentPositionGraphic(jsonFeature){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            var geom,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              graphic;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            geom = jsonUtils.fromJson(jsonFeature.geometry);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            graphic = new Graphic(geom, makeMarker(true), jsonFeature.attributes);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            return graphic;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          function makeTrailpointGraphic(jsGeometry){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            var graphic = new Graphic(jsGeometry, makeMarker(false), null);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            return graphic;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          function updateCurrentPosition(jsonFeature, currentPosition){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            var geom = jsonUtils.fromJson(jsonFeature.geometry);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            currentPosition.setGeometry(geom);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          function makeTrackLine(currentLineGraphic, trackPointGraphics, currentPositionGraphic){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            var track,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              line,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              path =[],</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              pathlength,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              p,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              pt;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            if (! trackPointGraphics || trackPointGraphics.length === 0){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              return false;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            pathlength = trackPointGraphics.length;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            if (! currentLineGraphic){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              currentLineGraphic = new Graphic();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              currentLineGraphic.setSymbol(makeLineSymbol());</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            line = new Polyline(trackPointGraphics[0].spatialReference);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            for (p = 0; p &lt; pathlength; p++){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              pt = new Point(trackPointGraphics[p].geometry.x, trackPointGraphics[p].geometry.y);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              path.push(pt);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            pt = new Point(currentPositionGraphic.geometry.x, currentPositionGraphic.geometry.y);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            path.push(pt)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            line.addPath(path);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            currentLineGraphic.setGeometry(line);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            return currentLineGraphic;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          function connectStreamLayer(){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            disconnectStreamLayer();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            if (! flightStreamLayer){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              flightStreamLayer = makeStreamLayer();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              map.addLayer(flightStreamLayer);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            else{</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              flightStreamLayer.connect();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            //connectSocket();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          /*</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">           * Disconnect StreamLayer from websocket and remove it from the map.</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">           * Also clear graphics from map</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">           */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          function disconnectStreamLayer(){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            if (flightStreamLayer){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              flightStreamLayer.suspend();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              flightStreamLayer.disconnect();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              flightStreamLayer.clear();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              map.removeLayer(flightStreamLayer);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              flightStreamLayer = null;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              graphicsColl = {};</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              trailLayer.clear();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              tracklineLayer.clear();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            if (connection){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              disconnectSocket();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              flightLayer.clear();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              trailLayer.clear();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              tracklineLayer.clear();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              graphicsColl = {};</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          function connectSocket(){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            if ("WebSocket" in window){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              console.log("WebSocket supported");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              var host = document.getElementById("txtWsUrl").value;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              connection = new WebSocket(host);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              connection.onopen = function(){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                console.log("Opened web socket");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              };</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              connection.onclose = function(m){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                console.log("Closed web socket",m);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                connection = null;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              };</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              connection.onerror = function(err){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                console.log("Error: ", err);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                connection = null;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              };</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              connection.onmessage = function(e){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                processMessage(e.data);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              };</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            else{</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              console.log("WebSocket not supported");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          function disconnectSocket(){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            connection.close();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          function makeRenderer(){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            var marker = makeMarker(true),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              obsRenderer = new SimpleRenderer(marker);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            return obsRenderer;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          /*</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">           * Make marker symbol</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">           */</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          function makeMarker(current){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            var color = current ? new Color([255,255,255, 0.8]) : new Color([240,240,240, 0.5]),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              size = current ? 4 : 1,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              marker = new SimpleMarkerSymbol();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            marker.setSize(size);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            marker.setColor(color);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            marker.setOutline(null);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            marker.setStyle("circle");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            return marker;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          function makeLineSymbol(){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">            var color = new Color([59,163,208,0.8]),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">              sls = new SimpleLineSymbol("solid", color, 0.6);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">             return sls;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        });</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  <span class="webkit-html-tag">&lt;/script&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;/html&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"></td></tr></tbody></table></body></html>